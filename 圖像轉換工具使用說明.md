# 電子紙圖像轉換工具使用說明

## 功能說明

本工具可將 `imagedata.cpp` 中的 C++ 陣列格式圖像資料轉換為標準的 BMP 圖檔格式，讓您能夠直接查看電子紙顯示器上會顯示的內容。

## 轉換結果

### 轉換完成的圖像檔案：

1. **`image1.bmp`** - 來自 `gImage_1[]` 陣列
   - 尺寸: 400 × 272 像素
   - 內容比例: 96.02%
   - 主要顏色分布:
     - 黑色: 83.8%
     - 紅色: 6.9%
     - 黃色: 5.4%
     - 白色: 4.0%

2. **`image2.bmp`** - 來自 `gImage_2[]` 陣列
   - 尺寸: 400 × 272 像素
   - 內容比例: 95.21%
   - 主要顏色分布:
     - 黑色: 89.1%
     - 白色: 4.8%
     - 紅色: 3.2%
     - 黃色: 2.9%

3. **`image3.bmp`** - 來自 `gImage_3[]` 陣列
   - 尺寸: 400 × 272 像素
   - 內容比例: 94.07%
   - 主要顏色分布:
     - 黑色: 77.4%
     - 紅色: 13.8%
     - 白色: 5.9%
     - 黃色: 2.9%

## 色彩對照表

電子紙使用 2bit 色彩編碼，對應關係如下：

| 2bit 值 | 十六進位 | 二進位 | 顏色 | RGB 值 |
|---------|----------|--------|------|--------|
| 0 | 0x00 | 00 | 黑色 | (0, 0, 0) |
| 1 | 0x01 | 01 | 白色 | (255, 255, 255) |
| 2 | 0x02 | 10 | 黃色 | (255, 255, 0) |
| 3 | 0x03 | 11 | 紅色 | (255, 0, 0) |

## 技術細節

### 圖像資料格式解析

1. **原始資料格式**:
   - 陣列大小: 53,856 位元組
   - 像素排列: 水平掃描
   - 每位元組包含: 4 個像素 (2bit × 4 = 8bit)

2. **像素解碼方式**:
   ```
   位元組值: 0xAB (例如: 0x5A)
   ├─ bits 7-6: 第1個像素 (01)
   ├─ bits 5-4: 第2個像素 (01)
   ├─ bits 3-2: 第3個像素 (10)
   └─ bits 1-0: 第4個像素 (10)

   結果: 白色, 白色, 黃色, 黃色
   ```

3. **尺寸轉換**:
   - 原始: 792×272 (每位元組4像素)
   - 實際: 400×272 (電子紙實際顯示尺寸)

## 使用工具

### 1. 主要轉換工具: `convert_to_bmp.py`

**功能**: 將 C++ 陣列轉換為 BMP 圖檔

**使用方法**:
```bash
python3 convert_to_bmp.py
```

**輸出檔案**:
- `image1.bmp` - gImage_1 陣列
- `image2.bmp` - gImage_2 陣列
- `image3.bmp` - gImage_3 陣列

### 2. 分析工具: `view_images.py`

**功能**: 分析生成的 BMP 圖像統計資訊

**使用方法**:
```bash
python3 view_images.py
```

**輸出資訊**:
- 圖像基本資訊 (尺寸、格式、模式)
- 顏色分布統計
- 內容比例分析

## 環境需求

- Python 3.x
- 必要套件:
  ```bash
  pip install Pillow numpy
  ```

## 程式碼架構

### `convert_to_bmp.py` 主要函數

1. **`parse_cpp_array(file, array_name)`**
   - 從 C++ 檔案解析指定陣列
   - 支援多種陣列定義格式
   - 使用正規表達式提取十六進位資料

2. **`decode_2bit_pixels(byte_data)`**
   - 解碼 2bit 像素資料
   - 每位元組拆分為 4 個像素值
   - 位元遮罩操作提取各像素

3. **`pixels_to_rgb_array(pixels, width, height)`**
   - 轉換像素值為 RGB 陣列
   - 根據色彩對照表映射顏色
   - 處理尺寸不符的情況

4. **`convert_array_to_bmp(byte_data, output, name)`**
   - 完整轉換流程
   - 建立 PIL 圖像對象
   - 尺寸縮放並儲存 BMP

## 擴展應用

### 1. 自訂圖像製作

可以建立反向轉換工具，將標準圖片轉為電子紙格式：

```python
def image_to_epaper_array(image_path):
    # 載入圖像 -> 調整尺寸 -> 色彩量化 -> 轉2bit -> 生成C++陣列
    pass
```

### 2. 即時預覽

整合到電子紙開發流程中：

```python
def preview_before_display(array_data):
    # 轉換陣列 -> 生成預覽圖 -> 顯示在開發環境
    pass
```

### 3. 批次處理

處理多個圖像檔案：

```bash
# 批次轉換所有 imagedata_*.cpp 檔案
for file in imagedata_*.cpp; do
    python3 convert_to_bmp.py "$file"
done
```

## 注意事項

1. **色彩限制**: 電子紙只支援 4 色，轉換時需要色彩量化
2. **刷新特性**: 電子紙刷新較慢，避免快速連續切換圖像
3. **記憶特性**: 圖像會在斷電後保持，適合靜態顯示
4. **尺寸固定**: 圖像必須符合 400×272 像素規格

透過這些工具，您可以清楚地看到電子紙顯示器實際會顯示的內容，大大提升開發效率！